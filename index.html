<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pol√≠cia de Lexus RolePlay</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-logo {
            filter: url(#gradient-filter);
        }
        .table-row:nth-child(even) {
            background-color: #2d3748;
        }
        .table-row:hover {
            background-color: #4a5568;
        }
        .dropdown {
            max-height: 200px;
            overflow-y: auto;
            position: absolute;
            z-index: 10;
            width: 100%;
            background: #2d3748;
            border: 1px solid #4a5568;
            border-radius: 0.375rem;
        }
        .dropdown-item:hover {
            background-color: #e53e3e;
        }
        .news-card {
            background-color: #2d3748;
            border: 1px solid #4a5568;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .news-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        .news-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #e53e3e;
            cursor: pointer;
        }
        .news-meta {
            font-size: 0.875rem;
            color: #a0aec0;
            margin-bottom: 0.5rem;
        }
        .news-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            color: #e2e8f0;
        }
        .news-content.open {
            max-height: 1000px;
        }
        .news-image {
            max-width: 100%;
            height: auto;
            margin-top: 1rem;
            border-radius: 0.375rem;
        }
        .delete-button {
            background-color: #c53030;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            margin-top: 1rem;
            display: inline-block;
        }
        .delete-button:hover {
            background-color: #9b2c2c;
        }
        .tab-button {
            background-color: #4a5568;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            margin-right: 0.5rem;
        }
        .tab-button.active {
            background-color: #e53e3e;
        }
        .tab-button:hover {
            background-color: #718096;
        }
        .login-container {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            border: 2px solid #e53e3e;
            border-radius: 0.5rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
            max-width: 400px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
        }
        .login-badge {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 80px;
            background: url('https://media.discordapp.net/attachments/1379269843458719766/1394140869073961041/sem_fundo.png?ex=68785d5d&is=68770bdd&hm=74ebc9cefb0e7d9afc2a7dc5a38d90fde59e9eb5543db45559ec4d96cc6886a9&=&format=webp&quality=lossless&width=438&height=438') no-repeat center;
            background-size: contain;
            filter: url(#gradient-filter);
        }
        .login-input {
            background-color: #2d3748;
            border: 1px solid #4a5568;
            color: white;
            padding: 0.75rem;
            border-radius: 0.375rem;
            width: 100%;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .login-input:focus {
            border-color: #e53e3e;
            box-shadow: 0 0 0 3px rgba(229, 62, 62, 0.3);
            outline: none;
        }
        .password-toggle {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #a0aec0;
        }
        .password-toggle:hover {
            color: #e53e3e;
        }
        .login-button {
            background-color: #e53e3e;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.375rem;
            width: 100%;
            font-weight: bold;
            transition: background-color 0.2s ease;
        }
        .login-button:hover {
            background-color: #c53030;
        }
        .spinner {
            display: none;
            border: 4px solid #e2e8f0;
            border-top: 4px solid #e53e3e;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 font-sans">
    <!-- SVG for gradient filter on logo -->
    <svg height="0" width="0">
        <defs>
            <filter id="gradient-filter">
                <feColorMatrix type="matrix" values="1 0 0 0 0
                                                    0 0.5 0 0 0
                                                    0 0 0.5 0 0
                                                    0 0 0 1 0" />
            </filter>
        </defs>
    </svg>

    <!-- Header -->
    <header class="bg-gradient-to-r from-red-900 to-gray-900 text-white py-4">
        <div class="container mx-auto px-4 flex items-center">
            <img src="https://media.discordapp.net/attachments/1379269843458719766/1394140869073961041/sem_fundo.png?ex=68785d5d&is=68770bdd&hm=74ebc9cefb0e7d9afc2a7dc5a38d90fde59e9eb5543db45559ec4d96cc6886a9&=&format=webp&quality=lossless&width=438&height=438" alt="Logo Pol√≠cia Lexus RolePlay" class="h-16 gradient-logo">
            <div>
                <h1 class="text-3xl font-bold">Pol√≠cia de Lexus RolePlay</h1>
                <p class="text-lg">Sistema Oficial de Consulta de Crimes e Penalidades</p>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="bg-gray-800 text-white py-2">
        <div class="container mx-auto px-4 flex justify-around items-center">
            <a href="#home" class="hover:text-red-500">In√≠cio</a>
            <a href="#news" class="hover:text-red-500">Not√≠cias</a>
            <a href="#crimes" id="crimes-link" class="hover:text-red-500 hidden">C√≥digos Penais</a>
            <a href="#calculator" id="calculator-link" class="hover:text-red-500 hidden">Calculadora Penal</a>
            <a href="#search" id="search-link" class="hover:text-red-500 hidden">Pesquisa de Crimes</a>
            <a href="#manage-access" id="manage-access-link" class="hover:text-red-500 hidden">Gerenciar</a>
            <div id="auth-nav" class="hidden flex items-center space-x-2">
                <span id="user-role" class="text-sm"></span>
                <button onclick="logout()" class="hover:text-red-500">Logout</button>
            </div>
        </div>
    </nav>

    <!-- Home Section -->
    <section id="home" class="container mx-auto px-4 py-8">
        <h2 class="text-2xl font-bold text-red-500 mb-4">Bem-vindo √† Pol√≠cia de Lexus RolePlay</h2>
        <p class="mb-4">Este √© o portal oficial da Pol√≠cia de Lexus RolePlay para consulta de c√≥digos penais, c√°lculo de penalidades, pesquisa de infra√ß√µes e not√≠cias policiais no servidor de GTA RP. Confira as √∫ltimas <a href="#news" class="text-red-500 hover:underline">Not√≠cias</a>. Oficiais podem acessar a <a href="#calculator" class="text-red-500 hover:underline">Calculadora Penal</a>, <a href="#crimes" class="text-red-500 hover:underline">C√≥digos Penais</a> e <a href="#search" class="text-red-500 hover:underline">Pesquisa de Crimes</a> ap√≥s login. Comandantes podem gerenciar acessos na se√ß√£o <a href="#manage-access" class="text-red-500 hover:underline">Gerenciar</a>.</p>
    </section>

    <!-- News Section -->
    <section id="news" class="container mx-auto px-4 py-8">
        <h2 class="text-2xl font-bold text-red-500 mb-4">Not√≠cias Policiais</h2>
        <div class="bg-gray-800 p-6 rounded-lg shadow-md">
            <div id="news-form" class="mb-6 hidden">
                <h3 class="text-lg font-semibold text-gray-200 mb-4">Adicionar Not√≠cia</h3>
                <label for="news-title" class="block text-gray-200 mb-2">T√≠tulo:</label>
                <input type="text" id="news-title" class="w-full p-2 border border-gray-600 rounded-md bg-gray-700 text-white mb-4" placeholder="T√≠tulo da not√≠cia">
                <label for="news-content" class="block text-gray-200 mb-2">Conte√∫do:</label>
                <textarea id="news-content" class="w-full p-2 border border-gray-600 rounded-md bg-gray-700 text-white mb-4" rows="4" placeholder="Escreva o conte√∫do da not√≠cia"></textarea>
                <label for="news-author" class="block text-gray-200 mb-2">Autor:</label>
                <input type="text" id="news-author" class="w-full p-2 border border-gray-600 rounded-md bg-gray-700 text-white mb-4" placeholder="Nome do autor">
                <label for="news-image-file" class="block text-gray-200 mb-2">Imagem (Upload):</label>
                <input type="file" id="news-image-file" accept="image/*" class="w-full p-2 border border-gray-600 rounded-md bg-gray-700 text-white mb-4">
                <label for="news-image-url" class="block text-gray-200 mb-2">Imagem (URL):</label>
                <input type="text" id="news-image-url" class="w-full p-2 border border-gray-600 rounded-md bg-gray-700 text-white mb-4" placeholder="Ex.: https://cdn.discordapp.com/...">
                <button onclick="addNews()" class="bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700">Publicar Not√≠cia</button>
            </div>
            <h3 class="text-lg font-semibold text-gray-200 mb-4">Not√≠cias Publicadas</h3>
            <div id="news-list" class="text-gray-200"></div>
        </div>
    </section>

    <!-- Penal Codes Section -->
    <section id="crimes" class="container mx-auto px-4 py-8 hidden">
        <h2 class="text-2xl font-bold text-red-500 mb-4">C√≥digos Penais de Lexus RolePlay</h2>
        <div class="overflow-x-auto">
            <table class="w-full bg-gray-800 shadow-md rounded-lg">
                <thead>
                    <tr class="bg-red-900 text-white">
                        <th class="py-2 px-4">Categoria</th>
                        <th class="py-2 px-4">Delito</th>
                        <th class="py-2 px-4">Artigo/C√≥digo</th>
                        <th class="py-2 px-4">Pena (Meses)</th>
                        <th class="py-2 px-4">Multa ($)</th>
                        <th class="py-2 px-4">Afian√ß√°vel</th>
                        <th class="py-2 px-4">Valor da Fian√ßa ($)</th>
                    </tr>
                </thead>
                <tbody id="crimes-table" class="text-gray-200"></tbody>
            </table>
        </div>
    </section>

    <!-- Penal Calculator Section -->
    <section id="calculator" class="container mx-auto px-4 py-8 hidden">
        <h2 class="text-2xl font-bold text-red-500 mb-4">Calculadora Penal</h2>
        <div class="bg-gray-800 p-6 rounded-lg shadow-md relative">
            <label for="crime-code" class="block text-lg text-gray-200 mb-2">Digite o Artigo ou Nome do Crime:</label>
            <input type="text" id="crime-code" class="w-full p-2 border border-gray-600 rounded-md bg-gray-700 text-white mb-4" placeholder="Ex.: Art. 155 ou Furto" oninput="showSuggestions()">
            <div id="suggestions" class="dropdown hidden"></div>
            <div class="flex space-x-4 mb-4">
                <button onclick="addCrime()" class="bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700">Adicionar Crime</button>
                <button onclick="clearSelection()" class="bg-gray-600 text-white py-2 px-4 rounded-md hover:bg-gray-700">Limpar Sele√ß√£o</button>
            </div>
            <div id="selected-crimes" class="mt-4 text-gray-200"></div>
            <div id="totals" class="mt-4 text-gray-200"></div>
        </div>
    </section>

    <!-- Crime Search Section -->
    <section id="search" class="container mx-auto px-4 py-8 hidden">
        <h2 class="text-2xl font-bold text-red-500 mb-4">Pesquisa de Crimes</h2>
        <div class="bg-gray-800 p-6 rounded-lg shadow-md">
            <label for="search-input" class="block text-lg text-gray-200 mb-2">Pesquisar por Delito, Artigo ou Categoria:</label>
            <input type="text" id="search-input" class="w-full p-2 border border-gray-600 rounded-md bg-gray-700 text-white mb-4" placeholder="Ex.: Furto, Art. 155, Pessoa">
            <button onclick="searchCrimes()" class="bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700">Pesquisar</button>
            <div id="search-results" class="mt-4 text-gray-200"></div>
        </div>
    </section>

    <!-- Manage Access Section -->
    <section id="manage-access" class="container mx-auto px-4 py-8 hidden">
        <h2 class="text-2xl font-bold text-red-500 mb-4">Gerenciar Acessos</h2>
        <div class="bg-gray-800 p-6 rounded-lg shadow-md">
            <div class="flex mb-4">
                <button class="tab-button active" onclick="showTab('create-access')">Criar Acesso</button>
                <button class="tab-button" onclick="showTab('remove-access')">Remover Acesso</button>
            </div>
            <div id="create-access" class="tab-content">
                <h3 class="text-lg font-semibold text-gray-200 mb-4">Criar Novo Usu√°rio</h3>
                <label for="new-username" class="block text-gray-200 mb-2">Usu√°rio:</label>
                <input type="text" id="new-username" class="w-full p-2 border border-gray-600 rounded-md bg-gray-700 text-white mb-4" placeholder="Digite o nome de usu√°rio">
                <label for="new-password" class="block text-gray-200 mb-2">Senha:</label>
                <input type="password" id="new-password" class="w-full p-2 border border-gray-600 rounded-md bg-gray-700 text-white mb-4" placeholder="Digite a senha">
                <label for="user-role" class="block text-gray-200 mb-2">Fun√ß√£o:</label>
                <select id="user-role" class="w-full p-2 border border-gray-600 rounded-md bg-gray-700 text-white mb-4">
                    <option value="officer">Oficial</option>
                </select>
                <button onclick="createUser()" class="bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700">Criar Usu√°rio</button>
                <p id="create-user-error" class="text-red-500 mt-2 hidden"></p>
            </div>
            <div id="remove-access" class="tab-content hidden">
                <h3 class="text-lg font-semibold text-gray-200 mb-4">Remover Usu√°rios</h3>
                <label for="user-search" class="block text-gray-200 mb-2">Pesquisar Usu√°rio:</label>
                <input type="text" id="user-search" class="w-full p-2 border border-gray-600 rounded-md bg-gray-700 text-white mb-4" placeholder="Digite o nome de usu√°rio" oninput="searchUsers()">
                <div id="user-list" class="mt-4 text-gray-200"></div>
                <button onclick="deleteSelectedUsers()" class="bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700 mt-4">Remover Selecionados</button>
            </div>
        </div>
    </section>

    <!-- Login Section -->
    <section id="login" class="container mx-auto px-4 py-8">
        <h2 class="text-2xl font-bold text-red-500 mb-4 text-center">Acesso ao Sistema Policial</h2>
        <div class="login-container relative">
            <div class="login-badge"></div>
            <div id="login-form">
                <div class="mb-4">
                    <label for="username" class="block text-gray-200 mb-2 font-semibold">Usu√°rio</label>
                    <input type="text" id="username" class="login-input" placeholder="Digite seu usu√°rio" aria-label="Usu√°rio">
                </div>
                <div class="mb-4 relative">
                    <label for="password" class="block text-gray-200 mb-2 font-semibold">Senha</label>
                    <input type="password" id="password" class="login-input pr-10" placeholder="Digite sua senha" aria-label="Senha">
                    <span class="password-toggle" onclick="togglePassword()" aria-label="Mostrar/esconder senha">üëÅÔ∏è</span>
                </div>
                <button id="login-button" class="login-button" onclick="login()">Entrar</button>
                <div id="login-spinner" class="spinner mt-4"></div>
                <p id="login-error" class="text-red-500 mt-4 text-center hidden">Usu√°rio ou senha incorretos.</p>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gradient-to-r from-red-900 to-gray-900 text-white py-4">
        <div class="container mx-auto px-4">
            <p>¬© 2025 Pol√≠cia de Lexus RolePlay. Todos os direitos reservados.</p>
        </div>
    </footer>

    <script>
        // Crimes array (to be provided by you)
        const crimes = [];

        // Users array
        let users = JSON.parse(localStorage.getItem('users')) || [
            { username: "ari", password: "arineto2016", role: "commander" },
            { username: "wl", password: "wl1112", role: "commander" }
        ];

        // News array
        let news = JSON.parse(localStorage.getItem('news')) || [
            {
                title: "Recrutamento Aberto para a Pol√≠cia de Lexus RolePlay",
                content: "A Pol√≠cia de Lexus RolePlay est√° com inscri√ß√µes abertas para novos oficiais! Buscamos cidad√£os comprometidos, corajosos e dispostos a manter a ordem e a seguran√ßa nas ruas de Los Santos. Requisitos: ser maior de 18 anos no roleplay, possuir habilita√ß√£o v√°lida para ve√≠culos (CNH categoria B, no m√≠nimo), n√£o ter antecedentes criminais graves (crimes inafian√ß√°veis), ter disponibilidade para treinamentos e opera√ß√µes em hor√°rios variados, e compromisso com as regras do servidor e do c√≥digo penal de Lexus. Para se inscrever, acesse o canal oficial da Pol√≠cia no Discord do servidor Lexus RolePlay, preencha o formul√°rio de inscri√ß√£o no canal #recrutamento, e participe da entrevista e do treinamento pr√°tico agendados pela equipe. Benef√≠cios incluem treinamento completo em opera√ß√µes policiais, oportunidade de ascens√£o hier√°rquica, equipamentos e viaturas de ponta, e integra√ß√£o com uma equipe dedicada e respeitada no servidor. N√£o perca essa chance de fazer parte da elite policial de Los Santos! Inscri√ß√µes abertas at√© 31/07/2025. Para d√∫vidas, contate o comando pelo Discord ou no QG da Pol√≠cia em Los Santos.",
                author: "Comandante Jo√£o Silva",
                date: "16/07/2025",
                image: "https://cdn.discordapp.com/attachments/1379269843458719766/1394908923315748875/pmerj.png?ex=68792e6b&is=6877dceb&hm=0470ba69d550125fe2ab6deb613af50f180f7bf98228d99fb2b319d83032e3ea&"
            }
        ];

        // Selected crimes for penal calculator
        let selectedCrimes = [];

        // Authentication state
        let currentUser = null;

        // Save users to localStorage
        function saveUsers() {
            localStorage.setItem('users', JSON.stringify(users));
        }

        // Save news to localStorage
        function saveNews() {
            localStorage.setItem('news', JSON.stringify(news));
        }

        // Toggle password visibility
        function togglePassword() {
            const passwordInput = document.getElementById('password');
            const toggle = document.querySelector('.password-toggle');
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggle.textContent = 'üôà';
            } else {
                passwordInput.type = 'password';
                toggle.textContent = 'üëÅÔ∏è';
            }
        }

        // Login function
        function login() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            const loginError = document.getElementById('login-error');
            const loginForm = document.getElementById('login-form');
            const loginButton = document.getElementById('login-button');
            const loginSpinner = document.getElementById('login-spinner');
            const authNav = document.getElementById('auth-nav');

            loginButton.classList.add('hidden');
            loginSpinner.style.display = 'block';
            loginError.classList.add('hidden');

            // Simulate server processing
            setTimeout(() => {
                const user = users.find(u => u.username === username && u.password === password);

                if (user) {
                    currentUser = user;
                    loginForm.classList.add('hidden');
                    authNav.classList.remove('hidden');
                    document.getElementById('user-role').textContent = `Bem-vindo, ${user.role === 'commander' ? 'Comandante' : 'Oficial'} ${user.username}`;
                    document.getElementById('username').value = '';
                    document.getElementById('password').value = '';
                    updateUIForUser();
                    window.location.hash = '#home'; // Redirect to home after login
                } else {
                    loginError.classList.remove('hidden');
                }

                loginButton.classList.remove('hidden');
                loginSpinner.style.display = 'none';
            }, 1000);
        }

        // Logout function
        function logout() {
            currentUser = null;
            document.getElementById('login-form').classList.remove('hidden');
            document.getElementById('auth-nav').classList.add('hidden');
            document.getElementById('news-form').classList.add('hidden');
            document.getElementById('crimes').classList.add('hidden');
            document.getElementById('calculator').classList.add('hidden');
            document.getElementById('search').classList.add('hidden');
            document.getElementById('manage-access').classList.add('hidden');
            document.getElementById('crimes-link').classList.add('hidden');
            document.getElementById('calculator-link').classList.add('hidden');
            document.getElementById('search-link').classList.add('hidden');
            document.getElementById('manage-access-link').classList.add('hidden');
            updateNewsList();
            window.location.hash = '#login'; // Redirect to login after logout
        }

        // Update UI based on user role
        function updateUIForUser() {
            const newsForm = document.getElementById('news-form');
            const crimesSection = document.getElementById('crimes');
            const calculatorSection = document.getElementById('calculator');
            const searchSection = document.getElementById('search');
            const manageAccessSection = document.getElementById('manage-access');
            const crimesLink = document.getElementById('crimes-link');
            const calculatorLink = document.getElementById('calculator-link');
            const searchLink = document.getElementById('search-link');
            const manageAccessLink = document.getElementById('manage-access-link');
            const roleSelect = document.getElementById('user-role');

            if (currentUser) {
                // Officers and commanders can see these sections
                crimesSection.classList.remove('hidden');
                calculatorSection.classList.remove('hidden');
                searchSection.classList.remove('hidden');
                crimesLink.classList.remove('hidden');
                calculatorLink.classList.remove('hidden');
                searchLink.classList.remove('hidden');

                // Only ari and wl can manage news
                if (currentUser.username === 'ari' || currentUser.username === 'wl') {
                    newsForm.classList.remove('hidden');
                } else {
                    newsForm.classList.add('hidden');
                }

                // All commanders can see manage access
                if (currentUser.role === 'commander') {
                    manageAccessSection.classList.remove('hidden');
                    manageAccessLink.classList.remove('hidden');
                    // Only ari and wl can assign commander role
                    if (currentUser.username === 'ari' || currentUser.username === 'wl') {
                        roleSelect.innerHTML = `
                            <option value="officer">Oficial</option>
                            <option value="commander">Comandante</option>
                        `;
                    } else {
                        roleSelect.innerHTML = `<option value="officer">Oficial</option>`;
                    }
                } else {
                    manageAccessSection.classList.add('hidden');
                    manageAccessLink.classList.add('hidden');
                }
            }
            updateNewsList();
        }

        // Populate crimes table
        function populateCrimesTable() {
            const tableBody = document.getElementById('crimes-table');
            tableBody.innerHTML = '';
            crimes.forEach(crime => {
                const row = document.createElement('tr');
                row.className = 'table-row';
                row.innerHTML = `
                    <td class="py-2 px-4">${crime.categoria}</td>
                    <td class="py-2 px-4">${crime.delito}</td>
                    <td class="py-2 px-4">${crime.artigo}</td>
                    <td class="py-2 px-4">${crime.pena}</td>
                    <td class="py-2 px-4">$${crime.multa.toLocaleString()}</td>
                    <td class="py-2 px-4">${crime.afiancavel}</td>
                    <td class="py-2 px-4">$${crime.fian√ßa.toLocaleString()}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Show suggestions for penal calculator
        function showSuggestions() {
            const input = document.getElementById('crime-code').value.trim().toLowerCase();
            const suggestionsDiv = document.getElementById('suggestions');
            suggestionsDiv.innerHTML = '';
            suggestionsDiv.classList.add('hidden');

            if (input.length === 0) return;

            const filteredCrimes = crimes.filter(crime => 
                crime.artigo.toLowerCase().includes(input) || 
                crime.delito.toLowerCase().includes(input)
            ).slice(0, 5);

            if (filteredCrimes.length > 0) {
                suggestionsDiv.classList.remove('hidden');
                filteredCrimes.forEach(crime => {
                    const div = document.createElement('div');
                    div.className = 'dropdown-item p-2 cursor-pointer text-gray-200';
                    div.textContent = `${crime.artigo} - ${crime.delito}`;
                    div.onclick = () => {
                        document.getElementById('crime-code').value = crime.artigo;
                        suggestionsDiv.innerHTML = '';
                        suggestionsDiv.classList.add('hidden');
                        addCrime(crime);
                    };
                    suggestionsDiv.appendChild(div);
                });
            }
        }

        // Add crime to selected list
        function addCrime(crime = null) {
            const codeInput = document.getElementById('crime-code').value.trim();
            const selectedCrime = crime || crimes.find(c => c.artigo.toLowerCase() === codeInput.toLowerCase());

            if (selectedCrime) {
                selectedCrimes.push(selectedCrime);
                document.getElementById('crime-code').value = '';
                updateSelectedCrimes();
            } else {
                const selectedCrimesDiv = document.getElementById('selected-crimes');
                selectedCrimesDiv.innerHTML = '<p class="text-red-500">C√≥digo ou crime n√£o encontrado. Verifique o artigo ou nome informado.</p>';
            }
        }

        // Update selected crimes display
        function updateSelectedCrimes() {
            const selectedCrimesDiv = document.getElementById('selected-crimes');
            const totalsDiv = document.getElementById('totals');
            selectedCrimesDiv.innerHTML = '';

            if (selectedCrimes.length === 0) {
                selectedCrimesDiv.innerHTML = '<p class="text-gray-400">Nenhum crime selecionado.</p>';
                totalsDiv.innerHTML = '';
                return;
            }

            let totalPenaltyMin = 0;
            let totalPenaltyMax = 0;
            let totalFine = 0;
            let totalBail = 0;
            let isBailable = selectedCrimes.every(crime => crime.afiancavel === "Sim");

            let tableHTML = '<table class="w-full bg-gray-800 rounded-lg"><thead><tr class="bg-red-900 text-white"><th class="py-2 px-4">Categoria</th><th class="py-2 px-4">Delito</th><th class="py-2 px-4">Artigo</th><th class="py-2 px-4">Pena</th><th class="py-2 px-4">Multa</th><th class="py-2 px-4">Afian√ß√°vel</th><th class="py-2 px-4">Fian√ßa</th></tr></thead><tbody>';
            selectedCrimes.forEach(crime => {
                const [min, max] = crime.pena.split('-').map(Number);
                totalPenaltyMin += min || 0;
                totalPenaltyMax += max || min || 0;
                totalFine += crime.multa;
                totalBail += crime.fian√ßa;
                tableHTML += `
                    <tr class="table-row">
                        <td class="py-2 px-4">${crime.categoria}</td>
                        <td class="py-2 px-4">${crime.delito}</td>
                        <td class="py-2 px-4">${crime.artigo}</td>
                        <td class="py-2 px-4">${crime.pena}</td>
                        <td class="py-2 px-4">$${crime.multa.toLocaleString()}</td>
                        <td class="py-2 px-4">${crime.afiancavel}</td>
                        <td class="py-2 px-4">$${crime.fian√ßa.toLocaleString()}</td>
                    </tr>
                `;
            });
            tableHTML += '</tbody></table>';
            selectedCrimesDiv.innerHTML = tableHTML;

            totalsDiv.innerHTML = `
                <p><strong>Total Pena:</strong> ${totalPenaltyMin}-${totalPenaltyMax} meses</p>
                <p><strong>Total Multa:</strong> $${totalFine.toLocaleString()}</p>
                <p><strong>Afian√ß√°vel:</strong> ${isBailable ? 'Sim' : 'N√£o'}</p>
                <p><strong>Total Fian√ßa:</strong> ${isBailable ? '$' + totalBail.toLocaleString() : 'N/A'}</p>
            `;
        }

        // Clear selected crimes
        function clearSelection() {
            selectedCrimes = [];
            document.getElementById('crime-code').value = '';
            updateSelectedCrimes();
        }

        // Search crimes
        function searchCrimes() {
            const searchInput = document.getElementById('search-input').value.trim().toLowerCase();
            const resultsDiv = document.getElementById('search-results');
            const filteredCrimes = crimes.filter(crime => 
                crime.delito.toLowerCase().includes(searchInput) ||
                crime.artigo.toLowerCase().includes(searchInput) ||
                crime.categoria.toLowerCase().includes(searchInput)
            );

            if (filteredCrimes.length > 0) {
                let resultsHTML = '<table class="w-full bg-gray-800 rounded-lg"><thead><tr class="bg-red-900 text-white"><th class="py-2 px-4">Categoria</th><th class="py-2 px-4">Delito</th><th class="py-2 px-4">Artigo</th><th class="py-2 px-4">Pena</th><th class="py-2 px-4">Multa</th><th class="py-2 px-4">Afian√ß√°vel</th><th class="py-2 px-4">Fian√ßa</th></tr></thead><tbody>';
                filteredCrimes.forEach(crime => {
                    resultsHTML += `
                        <tr class="table-row">
                            <td class="py-2 px-4">${crime.categoria}</td>
                            <td class="py-2 px-4">${crime.delito}</td>
                            <td class="py-2 px-4">${crime.artigo}</td>
                            <td class="py-2 px-4">${crime.pena}</td>
                            <td class="py-2 px-4">$${crime.multa.toLocaleString()}</td>
                            <td class="py-2 px-4">${crime.afiancavel}</td>
                            <td class="py-2 px-4">$${crime.fian√ßa.toLocaleString()}</td>
                        </tr>
                    `;
                });
                resultsHTML += '</tbody></table>';
                resultsDiv.innerHTML = resultsHTML;
            } else {
                resultsDiv.innerHTML = '<p class="text-red-500">Nenhum crime encontrado para o termo pesquisado.</p>';
            }
        }

        // Add news
        function addNews() {
            if (!currentUser || (currentUser.username !== 'ari' && currentUser.username !== 'wl')) return;

            const title = document.getElementById('news-title').value.trim();
            const content = document.getElementById('news-content').value.trim();
            const author = document.getElementById('news-author').value.trim();
            const imageFileInput = document.getElementById('news-image-file');
            const imageUrlInput = document.getElementById('news-image-url').value.trim();

            if (title && content && author) {
                if (imageFileInput.files && imageFileInput.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imageData = e.target.result;
                        const date = new Date().toLocaleDateString('pt-BR');
                        news.push({ title, content, author, date, image: imageData });
                        saveNews();
                        document.getElementById('news-title').value = '';
                        document.getElementById('news-content').value = '';
                        document.getElementById('news-author').value = '';
                        document.getElementById('news-image-file').value = '';
                        document.getElementById('news-image-url').value = '';
                        updateNewsList();
                    };
                    reader.readAsDataURL(imageFileInput.files[0]);
                } else if (imageUrlInput) {
                    const date = new Date().toLocaleDateString('pt-BR');
                    news.push({ title, content, author, date, image: imageUrlInput });
                    saveNews();
                    document.getElementById('news-title').value = '';
                    document.getElementById('news-content').value = '';
                    document.getElementById('news-author').value = '';
                    document.getElementById('news-image-file').value = '';
                    document.getElementById('news-image-url').value = '';
                    updateNewsList();
                } else {
                    const date = new Date().toLocaleDateString('pt-BR');
                    news.push({ title, content, author, date, image: '' });
                    saveNews();
                    document.getElementById('news-title').value = '';
                    document.getElementById('news-content').value = '';
                    document.getElementById('news-author').value = '';
                    document.getElementById('news-image-file').value = '';
                    document.getElementById('news-image-url').value = '';
                    updateNewsList();
                }
            }
        }

        // Delete news
        function deleteNews(index) {
            if (!currentUser || (currentUser.username !== 'ari' && currentUser.username !== 'wl')) return;
            news.splice(index, 1);
            saveNews();
            updateNewsList();
        }

        // Update news list
        function updateNewsList() {
            const newsList = document.getElementById('news-list');
            newsList.innerHTML = '';

            if (news.length === 0) {
                newsList.innerHTML = '<p class="text-gray-400">Nenhuma not√≠cia publicada.</p>';
                return;
            }

            news.forEach((item, index) => {
                const newsItem = document.createElement('div');
                newsItem.className = 'news-card';
                newsItem.innerHTML = `
                    <h4 class="news-title" onclick="toggleNews(${index})">${item.title}</h4>
                    <p class="news-meta">Publicado em: ${item.date} por ${item.author}</p>
                    <div id="news-content-${index}" class="news-content">
                        <p>${item.content.replace(/\n/g, '<br>')}</p>
                        ${item.image ? `<img src="${item.image}" class="news-image" alt="Imagem da not√≠cia">` : ''}
                    </div>
                    ${currentUser && (currentUser.username === 'ari' || currentUser.username === 'wl') ? `<button class="delete-button" onclick="deleteNews(${index})">Apagar Not√≠cia</button>` : ''}
                `;
                newsList.appendChild(newsItem);
            });
        }

        // Toggle news content
        function toggleNews(index) {
            const content = document.getElementById(`news-content-${index}`);
            content.classList.toggle('open');
        }

        // Create user
        function createUser() {
            if (!currentUser || currentUser.role !== 'commander') return;

            const username = document.getElementById('new-username').value.trim();
            const password = document.getElementById('new-password').value.trim();
            const role = document.getElementById('user-role').value;
            const error = document.getElementById('create-user-error');

            if (!username || !password) {
                error.textContent = 'Usu√°rio e senha s√£o obrigat√≥rios.';
                error.classList.remove('hidden');
                return;
            }

            if (users.find(u => u.username === username)) {
                error.textContent = 'Usu√°rio j√° existe.';
                error.classList.remove('hidden');
                return;
            }

            users.push({ username, password, role });
            saveUsers();
            document.getElementById('new-username').value = '';
            document.getElementById('new-password').value = '';
            document.getElementById('user-role').value = 'officer';
            error.classList.add('hidden');
            searchUsers();
        }

        // Search users
        function searchUsers() {
            const searchInput = document.getElementById('user-search').value.trim().toLowerCase();
            const userList = document.getElementById('user-list');
            const filteredUsers = users.filter(user => user.username.toLowerCase().includes(searchInput));

            userList.innerHTML = '';

            if (filteredUsers.length === 0) {
                userList.innerHTML = '<p class="text-gray-400">Nenhum usu√°rio encontrado.</p>';
                return;
            }

            let tableHTML = '<table class="w-full bg-gray-800 rounded-lg"><thead><tr class="bg-red-900 text-white"><th class="py-2 px-4">Selecionar</th><th class="py-2 px-4">Usu√°rio</th><th class="py-2 px-4">Fun√ß√£o</th></tr></thead><tbody>';
            filteredUsers.forEach((user, index) => {
                if (user.username !== 'ari' && user.username !== 'wl') {
                    tableHTML += `
                        <tr class="table-row">
                            <td class="py-2 px-4"><input type="checkbox" class="user-checkbox" data-username="${user.username}"></td>
                            <td class="py-2 px-4">${user.username}</td>
                            <td class="py-2 px-4">${user.role === 'commander' ? 'Comandante' : 'Oficial'}</td>
                        </tr>
                    `;
                }
            });
            tableHTML += '</tbody></table>';
            userList.innerHTML = tableHTML;
        }

        // Delete selected users
        function deleteSelectedUsers() {
            if (!currentUser || currentUser.role !== 'commander') return;

            const checkboxes = document.querySelectorAll('.user-checkbox:checked');
            const usernamesToDelete = Array.from(checkboxes).map(cb => cb.dataset.username);

            if (usernamesToDelete.length === 0) {
                document.getElementById('user-list').innerHTML = '<p class="text-red-500">Nenhum usu√°rio selecionado.</p>';
                return;
            }

            users = users.filter(user => !usernamesToDelete.includes(user.username));
            saveUsers();
            searchUsers();
        }

        // Show tab
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabId).classList.remove('hidden');
            document.querySelector(`button[onclick="showTab('${tabId}')"]`).classList.add('active');
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            populateCrimesTable();
            updateSelectedCrimes();
            updateNewsList();
            if (!currentUser) {
                document.getElementById('news-form').classList.add('hidden');
                document.getElementById('crimes').classList.add('hidden');
                document.getElementById('calculator').classList.add('hidden');
                document.getElementById('search').classList.add('hidden');
                document.getElementById('manage-access').classList.add('hidden');
                document.getElementById('crimes-link').classList.add('hidden');
                document.getElementById('calculator-link').classList.add('hidden');
                document.getElementById('search-link').classList.add('hidden');
                document.getElementById('manage-access-link').classList.add('hidden');
                document.getElementById('auth-nav').classList.add('hidden');
                window.location.hash = '#login'; // Default to login for non-logged-in users
            }
            searchUsers();
        });

        // Close dropdown on outside click
        document.addEventListener('click', (e) => {
            const suggestionsDiv = document.getElementById('suggestions');
            const input = document.getElementById('crime-code');
            if (!suggestionsDiv.contains(e.target) && e.target !== input) {
                suggestionsDiv.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
